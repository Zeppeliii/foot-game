<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>Footy Wordle - Tactical Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-correct: #28a745;
            --color-partial: #ffc107; /* 战术黄色：表示位置同线但非完全相同 */
            --color-wrong: #1a1f29;
            --color-bg: #0c1017;
            --color-panel: #131720;
            --color-border: #2c3e50;
            --color-text: #ffffff;
            --color-gold: #FFD700;
            --name-column-width: 150px;
            --glow-gold: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        @media (max-width: 600px) {
            :root {
                --name-column-width: 105px;
            }
        }

        body {
            font-family: 'Teko', 'PingFang SC', system-ui, sans-serif;
            background-color: var(--color-bg);
            background-image: radial-gradient(circle at 50% 0%, rgba(255, 215, 0, 0.12) 0%, transparent 60%),
            linear-gradient(rgba(12, 16, 23, 0.9), rgba(12, 16, 23, 0.9)),
            url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%232c3e50' fill-opacity='0.2' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3zm0 18.5L12.98 41v8h-2v-6.85L0 35.81v-2.3zM15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2zm0 49v-7.5L27.99 34H28v2.31h-.01L17 42.65V49h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: var(--color-text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            overflow-x: hidden;
        }

        .view {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
        }

        .active {
            display: flex;
        }

        #home-view {
            justify-content: center;
            height: 100vh;
            text-align: center;
        }

        .logo {
            font-size: 5.5rem;
            font-weight: 700;
            color: var(--color-gold);
            margin-bottom: 0;
            line-height: 0.85;
            font-style: italic;
            text-shadow: var(--glow-gold);
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            padding: 10px;
            box-sizing: border-box;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 12px 25px;
            box-sizing: border-box;
            background: var(--color-panel);
            border-top: 3px solid var(--color-gold);
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--glow-gold);
            margin-bottom: 15px;
            position: relative;
        }

        .stats-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1px;
            height: 50%;
            background: var(--color-border);
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 2.4rem;
            font-weight: 700;
            color: var(--color-gold);
            line-height: 1;
        }

        .stat-label {
            color: #666;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .timer-wrapper {
            width: 100%;
            height: 6px;
            background: #111;
            margin-bottom: 20px;
        }

        #timer-bar {
            height: 100%;
            background: var(--color-correct);
            transition: width 1s linear;
            box-shadow: 0 0 8px var(--color-correct);
        }

        .search-area {
            margin-bottom: 25px;
            position: relative;
            width: 100%;
            z-index: 1000;
        }

        input {
            width: 100%;
            padding: 16px;
            font-size: 1.3rem;
            background: var(--color-panel);
            color: var(--color-gold);
            border: 2px solid var(--color-border);
            outline: none;
            box-sizing: border-box;
            font-family: 'Teko';
        }

        input:focus {
            border-color: var(--color-gold);
            box-shadow: var(--glow-gold);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--color-panel);
            border: 2px solid var(--color-gold);
            border-top: none;
            max-height: 280px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
        }

        .search-item {
            padding: 14px 20px;
            border-bottom: 1px solid #222;
            cursor: pointer;
            font-size: 1.2rem;
            color: #eee;
            transition: 0.2s;
        }

        .search-item:hover {
            background: rgba(255, 215, 0, 0.15);
            color: var(--color-gold);
        }

        .table-header {
            display: grid;
            grid-template-columns: var(--name-column-width) repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 8px;
        }

        .header-item {
            font-size: 0.8rem;
            color: #555;
            text-align: center;
            font-weight: 700;
            font-style: italic;
        }

        .grid {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .row {
            display: grid;
            grid-template-columns: var(--name-column-width) repeat(5, 1fr);
            gap: 5px;
        }

        .cell {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-wrong);
            font-size: 1.1rem;
            font-weight: 600;
            border: 1px solid #222;
            overflow: hidden;
            position: relative;
            animation: flipIn 0.5s ease forwards;
        }

        .cell-content {
            width: 100%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 0 3px;
            box-sizing: border-box;
        }

        .cell.name-cell {
            aspect-ratio: auto;
            color: var(--color-gold);
            padding: 0 8px;
            border-left: 4px solid var(--color-gold);
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), transparent);
        }

        .name-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            text-align: center;
            font-style: italic;
            font-weight: 700;
        }

        /* 状态颜色 */
        .cell.correct {
            background-color: var(--color-correct);
            border-color: #3ed260;
            color: #000;
        }

        .cell.partial {
            background-color: var(--color-partial);
            border-color: #e0a800;
            color: #000;
        }

        .flag-icon {
            width: 32px;
            height: auto;
            filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
        }

        @keyframes flipIn {
            from {
                transform: rotateX(-90deg);
            }
            to {
                transform: rotateX(0);
            }
        }

        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(8, 10, 14, 0.98);
            z-index: 2000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        #msg-photo {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            border: 3px solid var(--color-gold);
            margin-bottom: 20px;
            object-fit: cover;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            display: none;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 35px;
        }

        .btn-main {
            padding: 16px 60px;
            background: linear-gradient(135deg, var(--color-gold), #e6c300);
            color: #000;
            border: none;
            font-weight: 800;
            font-size: 1.6rem;
            cursor: pointer;
            font-family: 'Teko';
            font-style: italic;
            clip-path: polygon(10% 0, 90% 0, 100% 50%, 90% 100%, 10% 100%, 0% 50%);
            transition: 0.2s;
        }

        .btn-practice {
            background: linear-gradient(135deg, #444, #222);
            color: #888;
            border: 1px solid #333;
        }

        .btn-main:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
    </style>
</head>
<body>

<div id="home-view" class="view active">
    <div class="logo">FOOTY<br>WORDLE</div>
    <p style="color: #444; font-style: italic; letter-spacing: 3px;">Tactical Scouting Terminal</p>
    <div class="btn-group">
        <button class="btn-main" onclick="switchView('game-view', false)">正式比赛 / MATCH</button>
        <button class="btn-main btn-practice" onclick="switchView('game-view', true)">练习模式 / PRACTICE</button>
    </div>
</div>

<div id="game-view" class="view">
    <div class="stats-bar">
        <div class="stat-item">
            <div id="lives-count" class="stat-value">10</div>
            <div class="stat-label">ATTEMPTS</div>
        </div>
        <div class="stat-item">
            <div id="timer-text" class="stat-value">30</div>
            <div class="stat-label">TIME LEFT</div>
        </div>
    </div>
    <div id="timer-container" class="timer-wrapper">
        <div id="timer-bar" style="width:100%;"></div>
    </div>

    <div class="game-container">
        <div class="search-area">
            <input type="text" id="guess-input" placeholder="SEARCH PLAYER..." autocomplete="off">
            <div id="search-results" class="search-results"></div>
        </div>

        <div class="table-header">
            <div class="header-item">PLAYER</div>
            <div class="header-item">NAT</div>
            <div class="header-item">LEA</div>
            <div class="header-item">CLUB</div>
            <div class="header-item">POS</div>
            <div class="header-item">AGE</div>
        </div>
        <div id="result-grid" class="grid"></div>
    </div>
</div>

<div id="overlay" class="overlay">
    <img id="msg-photo" src="" alt="Target Player">
    <h1 id="msg-title" style="font-size: 4.5rem; color: var(--color-gold); font-style: italic; margin: 0;"></h1>
    <p id="msg-body" style="font-size:1.6rem; margin-bottom:40px; color: #888;"></p>
    <button class="btn-main" onclick="startNewGame()">NEXT MISSION</button>
</div>

<script>
    const MAX_LIVES = 10;
    const ROUND_TIME = 30;
    let playerDatabase = [];
    let targetPlayer = null;
    let lives = MAX_LIVES;
    let timeLeft = ROUND_TIME;
    let timerInterval = null;
    let isPracticeMode = false;

    // 位置映射表
    const posGroups = {
        '后卫': ['左后卫', '右后卫', '中后卫'],
        '中场': ['中场', '进攻型中场', '防守型中场'],
        '前锋': ['中锋', '左翼', '右翼']
    };

    function getPosGroup(pos) {
        for (const group in posGroups) {
            if (posGroups[group].includes(pos)) return group;
        }
        return null;
    }

    const input = document.getElementById('guess-input');
    const resultsPanel = document.getElementById('search-results');

    async function init() {
        try {
            const res = await fetch('./players.json');
            playerDatabase = await res.json();
        } catch (e) {
            console.error("Data error. Check players.json.");
        }
    }

    input.addEventListener('input', (e) => {
        const val = e.target.value.trim().toLowerCase();
        if (!val) {
            resultsPanel.style.display = 'none';
            return;
        }
        const matches = playerDatabase.filter(p =>
            (p.displayName && p.displayName.toLowerCase().includes(val)) ||
            (p.name.toLowerCase().includes(val))
        ).slice(0, 10);
        if (matches.length > 0) {
            resultsPanel.innerHTML = matches.map(p => `
                <div class="search-item" onclick="handleSelect('${p.name.replace(/'/g, "\\'")}')">
                    <strong>${p.displayName || p.name}</strong>
                    <small style="color:#666; margin-left:10px;">${p.club}</small>
                </div>
            `).join('');
            resultsPanel.style.display = 'block';
        } else {
            resultsPanel.style.display = 'none';
        }
    });

    window.handleSelect = function (playerName) {
        const p = playerDatabase.find(x => x.name === playerName);
        if (p) {
            resultsPanel.style.display = 'none';
            input.value = "";
            makeGuess(p);
        }
    };

    function makeGuess(p) {
        if (!isPracticeMode) {
            lives--;
            document.getElementById('lives-count').innerText = lives;
        }
        renderRow(p);
        if (p.name === targetPlayer.name) {
            endGame(true, "MISSION ACCOMPLISHED");
        } else if (!isPracticeMode && lives <= 0) {
            endGame(false, "OUT OF ATTEMPTS");
        } else if (!isPracticeMode) {
            resetTimer();
        }
    }

    function renderRow(guess) {
        const grid = document.getElementById('result-grid');
        const row = document.createElement('div');
        row.className = 'row';

        const nameCell = document.createElement('div');
        nameCell.className = 'cell name-cell' + (guess.name === targetPlayer.name ? ' correct' : '');
        nameCell.innerHTML = `<div class="name-text">${guess.displayName || guess.name}</div>`;
        row.appendChild(nameCell);

        ['nation', 'league', 'club', 'pos', 'age'].forEach(f => {
            const cell = document.createElement('div');
            const isCorrect = guess[f] === targetPlayer[f];
            cell.className = 'cell';

            if (isCorrect) {
                cell.classList.add('correct');
            } else {
                if (f === 'pos') {
                    // 位置同线黄色逻辑
                    const gGroup = getPosGroup(guess.pos);
                    const tGroup = getPosGroup(targetPlayer.pos);
                    if (gGroup && tGroup && gGroup === tGroup) {
                        cell.classList.add('partial');
                    }
                }
                // 判断国家所属州/联合会相同
                if (f === 'nation') {
                    if (guess['state']  === targetPlayer['state']) {
                        cell.classList.add('partial');
                    }
                }
            }

            let val = guess[f];
            if (f === 'nation') {
                cell.classList.add('nation-cell');
                if (val && val.includes('http')) {
                    cell.innerHTML = `<img src="${val}" class="flag-icon" alt="flag">`;
                } else {
                    cell.innerText = val || "?";
                }
            } else {
                if (f === 'age' && !isCorrect) {
                    val += (parseInt(guess.age) < parseInt(targetPlayer.age) ? "↑" : "↓");
                }
                cell.innerHTML = `<div class="cell-content">${val}</div>`;
            }
            row.appendChild(cell);
        });
        grid.prepend(row);
    }

    function switchView(id, practice) {
        isPracticeMode = practice;
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (id === 'game-view') startNewGame();
    }

    function startNewGame() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('result-grid').innerHTML = "";
        targetPlayer = playerDatabase[Math.floor(Math.random() * playerDatabase.length)];
        if (isPracticeMode) {
            document.getElementById('lives-count').innerText = "∞";
            document.getElementById('timer-text').innerText = "∞";
            document.getElementById('timer-container').style.opacity = "0";
            clearInterval(timerInterval);
        } else {
            lives = MAX_LIVES;
            document.getElementById('lives-count').innerText = lives;
            document.getElementById('timer-container').style.opacity = "1";
            resetTimer();
        }
    }

    function resetTimer() {
        if (isPracticeMode) return;
        clearInterval(timerInterval);
        timeLeft = ROUND_TIME;
        const bar = document.getElementById('timer-bar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        void bar.offsetWidth;
        bar.style.transition = 'width 1s linear';
        updateTimerUI();
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerUI();
            if (timeLeft <= 0) endGame(false, "TIME EXPIRED");
        }, 1000);
    }

    function updateTimerUI() {
        if (isPracticeMode) return;
        document.getElementById('timer-text').innerText = timeLeft;
        document.getElementById('timer-bar').style.width = (timeLeft / ROUND_TIME) * 100 + "%";
    }

    function endGame(won, txt) {
        clearInterval(timerInterval);
        const photo = document.getElementById('msg-photo');
        if (targetPlayer.photo) {
            photo.src = targetPlayer.photo;
            photo.style.display = 'block';
        } else {
            photo.style.display = 'none';
        }
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('msg-title').innerText = won ? "VICTORY" : "DEFEAT";
        document.getElementById('msg-body').innerHTML = `${txt}<br><span style="color:var(--color-gold); font-size: 1.8rem;">TARGET: ${targetPlayer.displayName || targetPlayer.name}</span>`;
    }

    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-area')) resultsPanel.style.display = 'none';
    });

    init();
</script>
</body>
</html>